<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="csrf-token" content="{{ csrf_token() }}">
    <title>Knowledge Base & RAG - Day 15</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='rag.css') }}">
    <script src="https://cdn.socket.io/4.6.0/socket.io.min.js"></script>
</head>
<body>
    <div class="container">
        <!-- Compact Header -->
        <header class="compact-header">
            <div class="header-row">
                <div class="header-left">
                    <h1>üìö Knowledge Base & RAG</h1>
                </div>
                <div class="header-right">
                    <nav class="header-nav">
                        <a href="/" class="nav-link">üí¨ AI Agent</a>
                        <a href="/rag" class="nav-link active">üìö Knowledge Base</a>
                    </nav>
                    <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">üåô</button>
                </div>
            </div>
        </header>

        <!-- Stats Bar -->
        <div class="stats-bar">
            <div class="index-info">
                <span class="index-stat">
                    <span class="stat-icon">üìÑ</span>
                    <span id="header-files">0</span> files
                </span>
                <span class="index-stat">
                    <span class="stat-icon">üì¶</span>
                    <span id="header-chunks">0</span> chunks
                </span>
                <span class="index-stat">
                    <span class="stat-icon">üî§</span>
                    <span id="header-tokens">0</span> tokens
                </span>
            </div>
            <button class="btn-manage" id="manage-docs-btn">üì§ Manage Documents</button>
        </div>

        <!-- Main Content -->
        <main class="rag-main">
            <!-- Query Section -->
            <section class="query-section">
                <!-- Mode Selector -->
                <div class="mode-selector">
                    <button class="mode-btn active" data-mode="rag">üìö RAG Search</button>
                    <button class="mode-btn" data-mode="image">üñºÔ∏è Generate Image</button>
                    <button class="mode-btn" data-mode="style">üé® Style Generation</button>
                </div>

                <!-- RAG Mode -->
                <div id="rag-mode" class="mode-content active">
                    <h2>Ask Your Documents</h2>

                    <div class="query-input-wrapper">
                        <textarea
                            id="question-input"
                            placeholder="Ask a question about your indexed documents...&#10;Example: How to containerize a Python application with Docker?"
                            rows="4"
                        ></textarea>
                    </div>

                    <div class="query-controls">
                    <button class="btn-collapse" id="options-toggle">
                        ‚öôÔ∏è Options <span class="arrow">‚ñ∂</span>
                    </button>
                    <div class="options-content" id="options-content">
                        <div class="option-group">
                            <label>Top chunks: <span id="top-k-value">5</span></label>
                            <input type="range" id="top-k" min="1" max="10" value="5" step="1">
                        </div>
                        <div class="option-group">
                            <label>Min similarity: <span id="min-sim-value">0.00</span></label>
                            <input type="range" id="min-similarity" min="0" max="1" value="0.0" step="0.05">
                        </div>
                        <div class="option-group">
                            <label>Temperature: <span id="temperature-value">0.7</span></label>
                            <input type="range" id="temperature" min="0" max="2" value="0.7" step="0.1">
                        </div>
                        <div class="option-divider"></div>
                        <div class="option-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="enable-reranking">
                                <span>üîÑ Enable Reranking</span>
                            </label>
                        </div>
                        <div class="reranking-options" id="reranking-options" style="display: none;">
                            <div class="option-group">
                                <label>Retrieve chunks: <span id="top-k-retrieve-value">20</span></label>
                                <input type="range" id="top-k-retrieve" min="10" max="50" value="20" step="5">
                            </div>
                            <div class="option-group">
                                <label>Final chunks: <span id="top-k-final-value">5</span></label>
                                <input type="range" id="top-k-final" min="1" max="10" value="5" step="1">
                            </div>
                        </div>
                    </div>
                </div>

                    <div class="query-actions">
                        <button class="btn btn-primary" id="compare-btn">‚öñÔ∏è Compare Responses</button>
                        <button class="btn btn-primary" id="compare-reranking-btn">üîÑ Compare Reranking</button>
                        <button class="btn btn-secondary" id="with-rag-btn">üìö With RAG</button>
                        <button class="btn btn-secondary" id="without-rag-btn">ü§ñ Without RAG</button>
                    </div>
                </div>

                <!-- Image Generation Mode -->
                <div id="image-mode" class="mode-content" style="display: none;">
                    <h2>Generate Images</h2>

                    <div class="query-input-wrapper">
                        <textarea
                            id="image-prompt"
                            placeholder="Describe the image you want to generate...&#10;Example: a cute cat wearing sunglasses on a beach, sunset, highly detailed"
                            rows="4"
                        ></textarea>
                    </div>

                    <div class="query-controls">
                        <button class="btn-collapse" id="image-options-toggle">
                            ‚öôÔ∏è Options <span class="arrow">‚ñ∂</span>
                        </button>
                        <div class="options-content" id="image-options-content">
                            <div class="option-group">
                                <label>Model:</label>
                                <select id="image-model" class="model-select">
                                    <option value="flux-schnell">Flux Schnell (Fast, $0.003)</option>
                                    <option value="flux-dev">Flux Dev (Balanced, $0.025)</option>
                                    <option value="flux-pro">Flux Pro (Best, $0.055)</option>
                                    <option value="sdxl">SDXL (Budget, $0.002)</option>
                                </select>
                            </div>
                            <div class="option-group">
                                <label>Size:</label>
                                <select id="image-size" class="size-select">
                                    <option value="landscape_4_3">Landscape 4:3 (1024√ó768)</option>
                                    <option value="landscape_16_9">Landscape 16:9 (1024√ó576)</option>
                                    <option value="square">Square (512√ó512)</option>
                                    <option value="square_hd">Square HD (1024√ó1024)</option>
                                    <option value="portrait_4_3">Portrait 4:3 (768√ó1024)</option>
                                    <option value="portrait_16_9">Portrait 16:9 (576√ó1024)</option>
                                </select>
                            </div>
                            <div class="option-group">
                                <label>Steps (quality): <span id="steps-value">default</span></label>
                                <input type="range" id="image-steps" min="0" max="50" value="0" step="5">
                                <small>0 = model default</small>
                            </div>
                            <div class="option-group">
                                <label>
                                    <input type="checkbox" id="use-seed">
                                    Use seed for reproducibility
                                </label>
                                <input type="number" id="image-seed" placeholder="Random seed (e.g., 42)" disabled>
                            </div>
                        </div>
                    </div>

                    <div class="query-actions">
                        <button class="btn btn-primary" id="generate-image-btn">üé® Generate Image</button>
                        <button class="btn btn-secondary" id="view-stats-btn">üìä View Stats</button>
                    </div>
                </div>

                <!-- Style Generation Mode -->
                <div id="style-mode" class="mode-content" style="display: none;">
                    <h2>Brand-Consistent Generation</h2>

                    <div class="style-selector-wrapper">
                        <label for="style-profile">Style Profile:</label>
                        <select id="style-profile" class="style-select">
                            <option value="">Loading profiles...</option>
                        </select>
                        <button class="btn-info" id="style-info-btn">‚ÑπÔ∏è Info</button>
                    </div>

                    <div class="query-input-wrapper">
                        <label for="style-subject">Subject:</label>
                        <input
                            type="text"
                            id="style-subject"
                            placeholder="e.g., coffee cup, laptop, headphones"
                            class="style-input"
                        />
                    </div>

                    <div class="query-input-wrapper">
                        <label for="style-details">Additional Details (optional):</label>
                        <input
                            type="text"
                            id="style-details"
                            placeholder="e.g., on wooden table, with steam"
                            class="style-input"
                        />
                    </div>

                    <div class="query-controls">
                        <button class="btn-collapse" id="style-options-toggle">
                            ‚öôÔ∏è Options <span class="arrow">‚ñ∂</span>
                        </button>
                        <div class="options-content" id="style-options-content">
                            <div class="option-group">
                                <label>Model:</label>
                                <select id="style-model" class="model-select">
                                    <option value="">Default (from profile)</option>
                                    <option value="flux-schnell">Flux Schnell (Fast, $0.003)</option>
                                    <option value="flux-dev">Flux Dev (Balanced, $0.025)</option>
                                    <option value="flux-pro">Flux Pro (Best, $0.055)</option>
                                </select>
                            </div>
                            <div class="option-group">
                                <label>Size:</label>
                                <select id="style-size" class="size-select">
                                    <option value="">Default (from profile)</option>
                                    <option value="landscape_4_3">Landscape 4:3 (1024√ó768)</option>
                                    <option value="landscape_16_9">Landscape 16:9 (1024√ó576)</option>
                                    <option value="square">Square (512√ó512)</option>
                                    <option value="square_hd">Square HD (1024√ó1024)</option>
                                    <option value="portrait_4_3">Portrait 4:3 (768√ó1024)</option>
                                    <option value="portrait_16_9">Portrait 16:9 (576√ó1024)</option>
                                </select>
                            </div>
                            <div class="option-group">
                                <label>Variants for batch: <span id="num-variants-value">3</span></label>
                                <input type="range" id="num-variants" min="1" max="5" value="3" step="1">
                            </div>
                        </div>
                    </div>

                    <div class="query-actions">
                        <button class="btn btn-primary" id="generate-style-single-btn">üé® Generate</button>
                        <button class="btn btn-primary" id="generate-style-batch-btn">üì¶ Batch (3 variants)</button>
                        <button class="btn btn-secondary" id="compare-all-styles-btn">‚öñÔ∏è Compare All Styles</button>
                    </div>
                </div>
            </section>

            <!-- Results Section -->
            <div class="results-grid" id="results-grid">
                <!-- Empty state -->
                <div class="empty-state-full">
                    <h3>Ready to Query</h3>
                    <p>Ask a question to see how RAG enhances AI responses</p>
                    <div class="info-cards">
                        <div class="info-card">
                            <div class="info-icon">ü§ñ</div>
                            <h4>Without RAG</h4>
                            <p>LLM uses only its training knowledge</p>
                        </div>
                        <div class="info-card">
                            <div class="info-icon">üìö</div>
                            <h4>With RAG</h4>
                            <p>LLM uses your indexed documents as context</p>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Document Management Modal -->
        <div class="modal hidden" id="docs-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>üìö Manage Documents</h2>
                    <button class="modal-close" id="close-modal">‚úï</button>
                </div>
                <div class="modal-body">
                    <!-- Upload Zone -->
                    <div class="upload-zone" id="upload-zone">
                        <div class="upload-icon">üìÅ</div>
                        <p class="upload-text">Drag & drop files here</p>
                        <p class="upload-subtext">or click to browse</p>
                        <p class="upload-formats">Supported: .md, .txt, .py, .js, .json, .csv</p>
                        <input type="file" id="file-input" multiple accept=".md,.txt,.py,.js,.json,.csv" hidden>
                    </div>

                    <div class="selected-files" id="selected-files"></div>

                    <div class="upload-settings">
                        <button class="btn-collapse" id="settings-toggle">
                            üîß Settings <span class="arrow">‚ñ∂</span>
                        </button>
                        <div class="settings-content" id="settings-content">
                            <div class="setting-group">
                                <label>Chunk size: <span id="chunk-size-value">512</span> tokens</label>
                                <input type="range" id="chunk-size" min="256" max="1024" value="512" step="64">
                            </div>
                            <div class="setting-group">
                                <label>Overlap: <span id="overlap-value">50</span> tokens</label>
                                <input type="range" id="overlap" min="0" max="100" value="50" step="10">
                            </div>
                        </div>
                    </div>

                    <div class="upload-actions">
                        <button class="btn btn-primary" id="index-btn" disabled>üìä Index Documents</button>
                        <button class="btn btn-secondary" id="clear-files-btn" disabled>üóëÔ∏è Clear</button>
                    </div>

                    <!-- Progress Section -->
                    <div class="progress-section hidden" id="progress-section">
                        <h3>üîÑ Indexing Progress</h3>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progress-fill"></div>
                        </div>
                        <div class="progress-info" id="progress-info">
                            <p id="progress-text">Starting...</p>
                            <p id="progress-percent">0%</p>
                        </div>
                    </div>

                    <!-- Indexed Files List -->
                    <div class="indexed-files-section">
                        <h3>üìÑ Indexed Files</h3>
                        <div class="stats-details" id="stats-details"></div>
                        <button class="btn btn-danger btn-small" id="clear-index-btn">üóëÔ∏è Clear All Index</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='rag.js') }}"></script>
</body>
</html>
