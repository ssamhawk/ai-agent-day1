<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Agent - Day 10: MCP Pipeline Agent</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='day8-ui-patch.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='modern-settings.css') }}">
    <script src="{{ url_for('static', filename='utils.js') }}"></script>
    <!-- Socket.IO Client Library -->
    <script src="https://cdn.socket.io/4.6.0/socket.io.min.js" integrity="sha384-c79GN5VsunZvi+Q/WObgk2in0CbZsHnjEqvFxC5DxHn9lTfNce2WW6h2pH6u/kF+" crossorigin="anonymous"></script>
</head>
<body>
    <!-- Settings Toggle Button -->
    <button class="settings-toggle" id="settings-toggle" aria-label="Toggle settings panel" aria-expanded="false" aria-controls="settings-panel">
        âš™ï¸ Settings
    </button>

    <!-- Settings Panel -->
    <div class="settings-panel settings-panel--light" id="settings-panel" aria-hidden="true">
        <header class="settings-panel__header">
            <div class="settings-panel__header-main">
                <h2 class="settings-panel__title">Settings</h2>
            </div>
            <div class="settings-panel__header-actions">
                <button class="settings-close" id="settings-close" type="button" aria-label="Close settings">âœ•</button>
            </div>
        </header>

        <div class="settings-panel__content">
            <!-- Response Configuration -->
            <section class="settings-section">
                <div class="section-label">Response</div>

                <!-- Temperature: label + Ñ–Ğ½Ğ¿ÑƒÑ‚ + + -->
                <div class="field-group field-group--row field-group--temperature">
                    <label class="field-label">Temperature</label>
                    <div class="temperature-slots-container" id="temperature-slots">
                        <div class="temperature-slot">
                            <input type="number" class="temp-input" min="0" max="2" step="0.1" placeholder="0.7">
                            <button type="button" class="remove-temp" style="display:none;">âœ•</button>
                        </div>
                    </div>
                    <button type="button" id="add-temperature" class="add-temp-button">+</button>
                </div>

                <!-- Format: label + ÑĞµĞ»ĞµĞºÑ‚ + âš™ï¸ -->
                <div class="field-group field-group--row">
                    <label class="field-label">Format</label>
                    <select id="response-format" class="field-input format-select">
                        <option value="plain">Plain</option>
                        <option value="json">JSON</option>
                        <option value="markdown">Markdown</option>
                        <option value="xml">XML</option>
                    </select>
                    <button type="button" id="config-button" class="icon-btn" title="Configure fields">âš™ï¸</button>
                </div>

                <!-- Max Tokens: label + Ñ–Ğ½Ğ¿ÑƒÑ‚ -->
                <div class="field-group field-group--row">
                    <label class="field-label">Max Tokens</label>
                    <input type="number" id="max-tokens-input" class="field-input max-tokens-input" min="1" max="16384" step="1" placeholder="Auto">
                </div>
            </section>

            <div class="settings-divider"></div>

            <!-- Modes -->
            <section class="settings-section">
                <div class="section-label">Modes</div>

                <div class="toggle-item">
                    <input type="checkbox" id="pipeline-mode-checkbox" class="toggle-input">
                    <label for="pipeline-mode-checkbox" class="toggle-slider"></label>
                    <div class="toggle-content">
                        <div class="toggle-text">
                            <div class="toggle-title">ğŸ”— Pipeline Mode</div>
                            <div class="toggle-desc">Autonomous multi-step tool chaining (search â†’ process â†’ save)</div>
                        </div>
                    </div>
                </div>

                <div class="toggle-item">
                    <input type="checkbox" id="intelligent-mode-checkbox" class="toggle-input">
                    <label for="intelligent-mode-checkbox" class="toggle-slider"></label>
                    <div class="toggle-content">
                        <div class="toggle-text">
                            <div class="toggle-title">Smart Mode</div>
                            <div class="toggle-desc">Single-step MCP tools (Brave Search, Filesystem)</div>
                        </div>
                    </div>
                </div>
            </section>

            <div class="settings-divider"></div>

            <!-- Compression Settings -->
            <section class="settings-section">
                <div class="section-label">Compression</div>

                <div class="toggle-item">
                    <input type="checkbox" id="compression-checkbox" class="toggle-input" checked>
                    <label for="compression-checkbox" class="toggle-slider"></label>
                    <div class="toggle-content">
                        <div class="toggle-text">
                            <div class="toggle-title">Enable Compression</div>
                            <div class="toggle-desc">Automatically compress conversation history</div>
                        </div>
                    </div>
                </div>

                <div id="compression-options" class="compression-options">
                    <div class="field-group field-group--row">
                        <label class="field-label">Threshold</label>
                        <input type="number" id="compression-threshold" class="field-input" min="2" max="30" step="1" value="10">
                    </div>
                    <button class="stats-btn" type="button" id="stats-button">
                        <span class="stats-btn__icon">ğŸ“ˆ</span>
                        <span class="stats-btn__label">Stats</span>
                    </button>
                </div>
            </section>
        </div>
    </div>

    <div class="container">
        <header>
            <div class="header-left">
                <h1>ğŸ¤– AI Agent <span class="version-badge">Day 10</span></h1>
                <p class="subtitle">ğŸ”— MCP Pipeline Agent - Automated Tool Chaining</p>
            </div>
            <div class="header-right">
                <div class="mcp-status-bar" id="mcp-status-bar">
                    <div class="status-indicators" id="status-indicators">
                        <span class="loading-dots">Loading...</span>
                    </div>
                </div>
                <button class="clear-button" id="clear-button" aria-label="Clear conversation">ğŸ—‘ï¸ Clear</button>
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">ğŸŒ™</button>
            </div>
        </header>

        <div class="chat-container">
            <div id="chat-messages" class="chat-messages">
                <div class="welcome-message">
                    <h2>ğŸ”— MCP Pipeline Agent</h2>
                    <p class="welcome-desc">Autonomous agent that chains MCP tools into automated pipelines</p>

                    <div class="features-compact">
                        <span class="feature-tag">ğŸ”— Tool Chaining</span>
                        <span class="feature-tag">ğŸ” Web Search</span>
                        <span class="feature-tag">ğŸ“ File Operations</span>
                        <span class="feature-tag">ğŸ’¾ Auto-Save Results</span>
                        <span class="feature-tag">ğŸ¤– Autonomous Execution</span>
                    </div>

                    <div class="mcp-servers-compact">
                        <div class="servers-label">Pipeline Tools:</div>
                        <div id="servers-list" class="servers-inline">
                            <span class="loading-text">Loading...</span>
                        </div>
                    </div>

                    <div class="pipeline-examples" style="margin-top: 20px; padding: 15px; background: rgba(99, 102, 241, 0.1); border-radius: 8px; border-left: 3px solid #6366f1;">
                        <div style="font-weight: 600; margin-bottom: 8px; color: #6366f1;">ğŸ“ Example Pipelines:</div>
                        <div style="font-size: 0.9em; line-height: 1.6; opacity: 0.9;">
                            â€¢ "Research Python 3.12 features and save summary to ~/python_notes.md"<br>
                            â€¢ "Find information about Flask security and create a guide"<br>
                            â€¢ "List files in ~/projects and create an inventory report"<br>
                            â€¢ "Search for Docker best practices and save to ~/docker_guide.txt"
                        </div>
                    </div>
                </div>
            </div>

            <div class="input-container">
                <form id="chat-form">
                    <div class="input-area">
                        <textarea
                            id="user-input"
                            placeholder="Type your message..."
                            autocomplete="off"
                            rows="3"
                            required
                        ></textarea>
                        <button type="submit" id="send-button">
                            <span class="button-text">Send</span>
                            <span class="loading-spinner" style="display: none;">â³</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <footer>
            <p>Day 10 Challenge - MCP Pipeline Agent and Automated Tool Chaining</p>
        </footer>
    </div>

    <!-- Configuration Modal -->
    <div id="config-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>âš™ï¸ Configure Response Structure</h3>
                <button class="modal-close" id="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <p class="modal-description">Select which fields to include in structured responses (JSON/XML/Markdown):</p>

                <div class="config-section">
                    <label class="config-option">
                        <input type="checkbox" name="field" value="answer" checked disabled>
                        <span class="config-label">ğŸ’¬ Answer <span class="required">(required)</span></span>
                    </label>

                    <label class="config-option">
                        <input type="checkbox" name="field" value="category" id="field-category" checked>
                        <span class="config-label">ğŸ·ï¸ Category</span>
                    </label>

                    <label class="config-option">
                        <input type="checkbox" name="field" value="key_points" id="field-key-points" checked>
                        <span class="config-label">âœ¨ Key Points</span>
                    </label>

                    <label class="config-option">
                        <input type="checkbox" name="field" value="confidence" id="field-confidence">
                        <span class="config-label">ğŸ“Š Confidence Level</span>
                    </label>

                    <label class="config-option">
                        <input type="checkbox" name="field" value="sources" id="field-sources">
                        <span class="config-label">ğŸ“š Sources</span>
                    </label>

                    <label class="config-option">
                        <input type="checkbox" name="field" value="related_topics" id="field-related">
                        <span class="config-label">ğŸ”— Related Topics</span>
                    </label>
                </div>

                <div class="custom-fields-section">
                    <h4>âœï¸ Custom Fields</h4>
                    <p class="custom-description">Add your own fields (comma-separated). Example: summary, examples, best_practices</p>
                    <input
                        type="text"
                        id="custom-fields-input"
                        class="custom-fields-input"
                        placeholder="e.g., summary, examples, tips"
                    >
                    <div id="custom-fields-preview" class="custom-fields-preview"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="reset-config">Reset to Default</button>
                <button class="btn-primary" id="save-config">Save Configuration</button>
            </div>
        </div>
    </div>

    <!-- Compression Stats Modal -->
    <div id="stats-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ğŸ“Š Compression Statistics</h3>
                <button class="modal-close" id="stats-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Total Messages</div>
                        <div class="stat-value" id="stat-total-messages">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Summaries Created</div>
                        <div class="stat-value" id="stat-summaries">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Recent Messages</div>
                        <div class="stat-value" id="stat-recent">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Original Tokens</div>
                        <div class="stat-value" id="stat-original-tokens">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Compressed Tokens</div>
                        <div class="stat-value" id="stat-compressed-tokens">0</div>
                    </div>
                    <div class="stat-card highlight">
                        <div class="stat-label">Tokens Saved</div>
                        <div class="stat-value" id="stat-savings">0</div>
                        <div class="stat-percent" id="stat-percent">0%</div>
                    </div>
                </div>
                <div class="summaries-section" id="summaries-section" style="display:none;">
                    <h4>ğŸ“ Conversation Summaries</h4>
                    <div id="summaries-list"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>
